<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<title>Welcome</title>
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<!-- 引入 Swiper 样式 -->
	<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
	<!-- 异步加载广告脚本 -->
	<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7976057848601572"
		async></script>
	<!-- Google Tag Manager -->
	<script>
		(function (w, d, s, l, i) {
			w[l] = w[l] || [];
			w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
			var f = d.getElementsByTagName(s)[0],
				j = d.createElement(s),
				dl = l != 'dataLayer' ? '&l=' + l : '';
			j.async = true;
			j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
			f.parentNode.insertBefore(j, f);
		})(window, document, 'script', 'dataLayer', 'GTM-TS48XJVF');
	</script>
	<!-- End Google Tag Manager -->

	<style>
		/* ----------------------- 基本样式 ----------------------- */
		body {
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
			text-align: center;
		}

		.container {
			text-align: center;
			padding: 0 10px;
		}

		.title {
			color: red;
			padding: 10px;
			border-radius: 4px;
			font-size: 54px;
			margin-bottom: 5px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.title img {
			margin-right: 10px;
			height: 24px;
			width: auto;
		}

		.gradient-box {
			background: linear-gradient(to right, #ff7e5f, #feb47b);
			height: 10px;
			margin-bottom: 10px;
		}

		/* ----------------------- 轮播图样式 ----------------------- */
		/* 采用百分比宽度并使用内填充比例保证宽高比 */
		.swiper-container {
			width: 100%;
			max-width: 800px;
			position: relative;
			margin: 0 auto 20px auto;
			/* 16:9 纵横比：9/16=56.25% */
			height: 0;
			padding-bottom: 56.25%;
		}

		.swiper-wrapper {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}

		.swiper-slide {
			text-align: center;
			position: relative;
			width: 100%;
			height: 100%;
		}

		.swiper-slide img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.swiper-button-prev,
		.swiper-button-next {
			color: #fff;
		}

		.swiper-pagination-bullet {
			background: rgba(0, 0, 0, 0.5);
		}

		.swiper-pagination-bullet-active {
			background: #fff;
		}

		/* ----------------------- 内容区域 ----------------------- */
		.content-section {
			margin: 20px 0;
			text-align: left;
			padding: 0 15px;
		}

		.content-section h2 {
			color: #333;
		}

		.content-section p {
			color: #666;
			line-height: 1.5;
		}

		.header {
			margin: 20px 0;
		}

		.search-bar {
			display: flex;
			justify-content: center;
			align-items: center;
			margin-bottom: 20px;
			flex-wrap: wrap;
		}

		.tab-select,
		.search-input {
			padding: 8px;
			cursor: pointer;
			border: 1px solid #ccc;
			margin: 5px;
			width: 100%;
			max-width: 180px;
			font-size: 16px;
			border-radius: 20px;
		}

		.thumbnail-container {
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
			gap: 10px;
		}

		.subtitle {
			color: #e21111;
			padding: 10px;
			font-size: 20px;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0;
		}

		.subtitle img {
			margin-right: 8px;
			height: 24px;
			width: auto;
		}

		.hidden {
			display: none;
		}

		/* ----------------------- 视频弹窗样式 ----------------------- */
		/* 视频弹窗整体背景不变 */
		.modal {
		  display: none;
		  position: fixed;
		  z-index: 1000;
		  top: 0;
		  left: 0;
		  width: 100%;
		  height: 100%;
		  background-color: rgba(0, 0, 0, 0.7);
		  justify-content: center;
		  align-items: center;
		}

		/* 新的弹窗容器样式：自适应手机 */
		/* 弹窗容器样式 */
		.modal-content {
		  position: fixed !important;
		  top: 50% !important;
		  left: 50% !important;
		  transform: translate(-50%, -50%) !important;
		  /* 不再固定宽度，而是由 JS 动态设置 */
		  overflow: hidden;
		  padding: 10px;
		  background: #fff;
		  border-radius: 8px;
		  display: flex;
		  flex-direction: column;
		  box-sizing: border-box;
		}

		/* 视频元素充满容器 */
		.modal-content video {
		  width: 100%;
		  height: 100%;
		  object-fit: contain;
		  display: block;
		}

		/* 关闭按钮样式保持不变 */
		.close {
		  position: absolute;
		  top: 10px;
		  right: 20px;
		  font-size: 24px;
		  cursor: pointer;
		}

		/* ----------------------- 缩略图及新结构样式 ----------------------- */
		.thumbnail {
			border: 1px solid #ddd;
			border-radius: 8px;
			overflow: hidden;
			margin: 10px;
			display: flex;
			flex-direction: column;
			background: #fff;
			width: 30%;
		}

		.thumb-image {
			cursor: pointer;
			width: 100%;
			overflow: hidden;
		}

		.thumb-image img {
			width: 100%;
			height: auto;
			display: block;
		}

		.episode-info {
			padding: 10px;
			text-align: center;
			background: #f9f9f9;
		}

		.episode-info .episode-title {
			font-size: 16px;
			font-weight: bold;
			color: #333;
			cursor: pointer;
			display: block;
			margin-bottom: 8px;
		}

		.episode-info .preview-btn {
			padding: 8px 16px;
			font-size: 14px;
			border: none;
			background: #ff7e5f;
			color: #fff;
			border-radius: 4px;
			cursor: pointer;
			transition: background 0.3s ease;
		}

		.episode-info .preview-btn:hover {
			background: #feb47b;
		}

		/* ----------------------- 响应式调整 ----------------------- */
		@media (max-width: 1024px) {
			.thumbnail {
				width: calc(33.33% - 10px);
			}
		}

		@media (max-width: 600px) {
			.thumbnail {
				width: calc(50% - 10px);
				margin: 5px;
			}

			.episode-info .episode-title {
				font-size: 14px;
			}

			.episode-info .preview-btn {
				font-size: 12px;
				padding: 6px 12px;
			}
		}

		/* 针对更小屏幕，如手机极小屏，采用单列布局 */
		@media (max-width: 400px) {
			.thumbnail {
				width: calc(100% - 10px);
				margin: 5px;
			}
		}
	</style>
</head>

<body>
	<!-- Google Tag Manager (noscript) -->
	<script>
		window.addEventListener('load', function () {
			var gtm = document.createElement('script');
			gtm.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-TS48XJVF';
			gtm.async = true;
			document.body.appendChild(gtm);
		});
	</script>
	<!-- End Google Tag Manager (noscript) -->

	<div class="container">
		<div class="title">
			<img alt="Icon" src="hot.webp" />
			Hot Drama
		</div>
		<div class="gradient-box"></div>
		<!-- 轮播图 -->
		<div class="swiper-container">
			<div class="swiper-wrapper">
				<div class="swiper-slide">
					<a href="https://short.kalostv.com/api/short/jump/675c53f73a3c9" target="_blank">
						<img alt="Image 1" src="ii1.webp" />
					</a>
				</div>
				<div class="swiper-slide">
					<a href="https://short.kalostv.com/api/short/jump/675c534ac599d" target="_blank">
						<img alt="Image 2" src="ii2.webp" />
					</a>
				</div>
				<div class="swiper-slide">
					<a href="https://short.kalostv.com/api/short/jump/675c531156f4f" target="_blank">
						<img alt="Image 3" src="ii3.webp" />
					</a>
				</div>
				<div class="swiper-slide">
					<a href="https://short.kalostv.com/api/short/jump/675c53f73a3c9" target="_blank">
						<img alt="Image 4" src="ii4.webp" />
					</a>
				</div>
				<div class="swiper-slide">
					<a href="https://short.kalostv.com/api/short/jump/675c8297121ed" target="_blank">
						<img alt="Image 5" src="ii5.webp" />
					</a>
				</div>
				<div class="swiper-slide">
					<a href="https://short.kalostv.com/api/short/jump/675c52b1b2dd8" target="_blank">
						<img alt="Image 6" src="ii6.webp" />
					</a>
				</div>
			</div>
			<!-- 左右导航按钮 -->
			<div class="swiper-button-prev"></div>
			<div class="swiper-button-next"></div>
			<!-- 分页器 -->
			<div class="swiper-pagination"></div>
		</div>

		<!-- 新内容区域 -->
		<div class="subtitle">
			<img alt="Icon" src="search.webp" />
			Search More Drama
		</div>
		<div class="gradient-box"></div>
		<div class="content-section">
			<div class="search-bar">
				<select class="tab-select" id="tabSelect" onchange="changeTab(this.value)">
					<option value="0">English</option>
					<option value="1">Indonesian</option>
					<option value="2">Spanish</option>
					<option value="3">French</option>
					<option value="4">Korean</option>
					<option value="5">Japanese</option>
					<option value="6">German</option>
					<option value="7">Thai</option>
					<option value="8">Traditional Chinese</option>
				</select>
				<input class="search-input" id="searchInput" onkeyup="filterThumbnails()" placeholder="Search Drama"
					type="text" />
			</div>
			<div class="thumbnail-container" id="thumbnailContainer">
			</div>
			<div style="text-align:center; margin: 20px;">
				<button id="loadMoreBtn">Load More</button>
			</div>
			<script>
				function changeTab(selectedValue) {
					currentTab = selectedValue;
					const container = document.getElementById("thumbnailContainer");
					container.innerHTML = "";
					loadedCounts[selectedValue] = 0;
					loadThumbnails(selectedValue);
				}
			</script>
		</div>
	</div>

	<!-- 视频弹窗 -->
	<div class="modal" id="videoModal">
		<div class="modal-content">
			<span class="close">×</span>
			<video controls id="videoPlayer">
				<source id="videoSource" src="" type="video/mp4" />
				您的浏览器不支持 video 标签。
			</video>
		</div>
	</div>

	<!-- 引入剧集数据 -->
	<script src="thumbnailsData.js"></script>

	<!-- 全局变量定义 -->
	<script>
		// 全局变量定义
		let currentTab = "0"; // 默认英语类别（与下拉框第一个选项一致）
		const batchSize = 50;
		const loadedCounts = {};

		// 按批次加载函数（保持原有逻辑）
		function loadThumbnails(tab) {
			const container = document.getElementById("thumbnailContainer");
			if (!loadedCounts[tab]) {
				loadedCounts[tab] = 0;
			}
			const startIndex = loadedCounts[tab];
			const thumbnailsArray = thumbnailsData[tab] || [];
			const endIndex = Math.min(startIndex + batchSize, thumbnailsArray.length);
			for (let i = startIndex; i < endIndex; i++) {
				const tempDiv = document.createElement("div");
				tempDiv.innerHTML = thumbnailsArray[i];
				container.appendChild(tempDiv.firstElementChild);
			}
			loadedCounts[tab] = endIndex;
			const loadMoreBtn = document.getElementById("loadMoreBtn");
			loadMoreBtn.style.display = loadedCounts[tab] >= thumbnailsArray.length ? "none" : "block";
		}

		// 绑定点击事件，增加 event.isTrusted 检查，确保只响应用户操作
		document.getElementById("thumbnailContainer").addEventListener("click", function (event) {
		  if (!event.isTrusted) return;

		  // 点击“点击预览”按钮时
		  if (event.target.closest(".preview-btn")) {
			const thumbnailEl = event.target.closest(".thumbnail");
			const videoUrl = thumbnailEl.getAttribute("data-video");
			if (videoUrl) {
			  openVideoModal(videoUrl, thumbnailEl); // 传入剧集项元素
			}
			event.stopPropagation();
			return;
		  }

		// 其他点击处理...
		  if (event.target.closest(".thumb-image") || event.target.closest(".episode-title")) {
			const thumbnailEl = event.target.closest(".thumbnail");
			const commissionUrl = thumbnailEl.getAttribute("data-commission");
			if (commissionUrl) {
			  window.open(commissionUrl, '_blank');
			}
			event.stopPropagation();
			return;
		  }
		});


		// 打开视频弹窗的函数
		function openVideoModal(videoUrl, thumbnailEl) {
		  // 获取被点击剧集项的尺寸
		  const rect = thumbnailEl.getBoundingClientRect();
		  const modalContent = document.querySelector(".modal-content");

		  // 设置弹窗容器的宽度和高度与剧集项相同
		  modalContent.style.width = rect.width + "px";
		  modalContent.style.height = rect.height + "px";

		  // 更新视频源并加载视频
		  document.getElementById("videoSource").src = videoUrl;
		  document.getElementById("videoPlayer").load();

		  // 显示视频弹窗
		  document.getElementById("videoModal").style.display = "flex"; // 使用 flex 布局，确保居中
	}


		// 关闭视频弹窗（点击关闭按钮）
		document.querySelector(".close").addEventListener("click", function () {
			document.getElementById("videoModal").style.display = "none";
			document.getElementById("videoPlayer").pause();
			document.getElementById("videoSource").src = "";
		});

		// 点击弹窗背景关闭弹窗
		document.getElementById("videoModal").addEventListener("click", function (event) {
			if (event.target === this) {
				this.style.display = "none";
				document.getElementById("videoPlayer").pause();
				document.getElementById("videoSource").src = "";
			}
		});

		// 页面加载后延时加载剧集数据，确保页面渲染稳定
		document.addEventListener("DOMContentLoaded", function () {
			// 延时100毫秒加载数据，避免加载过程中产生意外的事件触发
			setTimeout(function () {
				loadThumbnails(currentTab);
			}, 100);
		});
	</script>

	<!-- 引入 Swiper 脚本（只引入一次） -->
	<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
	<script>
		var mySwiper = new Swiper('.swiper-container', {
			loop: true,
			autoplay: {
				delay: 1500,
				disableOnInteraction: true,
			},
			navigation: {
				nextEl: '.swiper-button-next',
				prevEl: '.swiper-button-prev',
			},
			pagination: {
				el: '.swiper-pagination',
				clickable: true,
			},
			speed: 1000,
		});
	</script>

	<script>
		function filterThumbnails() {
			// 1. 获取当前用户输入的搜索词，并转小写用于匹配
			const searchTerm = document.getElementById("searchInput").value.trim().toLowerCase();

			// 2. 获取当前选中的语言 tab（你在 changeTab 中使用了 currentTab 作标记）
			const tab = currentTab;

			// 3. 先清空容器
			const container = document.getElementById("thumbnailContainer");
			container.innerHTML = "";

			// 4. 如果当前 tab 无数据，或者 thumbnailsData[tab] 不存在，直接返回
			if (!thumbnailsData[tab]) {
				return;
			}

			// 5. 如果搜索词为空，则“恢复”原始全部结果
			if (searchTerm === "") {
				// 重置已加载计数
				loadedCounts[tab] = 0;
				// 重新调用原先的加载逻辑
				loadThumbnails(tab);
				// 显示“Load More”按钮
				document.getElementById("loadMoreBtn").style.display = "block";
				return;
			}

			// 6. 如果有搜索词，则在当前 tab 里做过滤
			//    这里简单处理：只要 HTML 片段中包含搜索词(不区分大小写)，就算匹配
			const allItems = thumbnailsData[tab]; // 所有HTML片段数组
			let filteredItems = allItems.filter(item => {
				// 转小写，与 searchTerm 作 includes 判断
				const lowerItem = item.toLowerCase();
				return lowerItem.includes(searchTerm);
			});

			// 7. 将搜索结果一次性加载到容器
			filteredItems.forEach(htmlSnippet => {
				let tempDiv = document.createElement("div");
				tempDiv.innerHTML = htmlSnippet;
				container.appendChild(tempDiv.firstElementChild);
			});

			// 8. 隐藏“Load More”按钮（因为此时是一次性显示所有匹配内容）
			document.getElementById("loadMoreBtn").style.display = "none";
		}
	</script>
</body>

</html>