<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<title>Welcome</title>
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<!-- 引入 Swiper 样式 -->
	<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
	<!-- 异步加载广告脚本 -->
	<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7976057848601572"
		async></script>
	<!-- Google Tag Manager -->
	<script>
		(function (w, d, s, l, i) {
			w[l] = w[l] || [];
			w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
			var f = d.getElementsByTagName(s)[0],
				j = d.createElement(s),
				dl = l != 'dataLayer' ? '&l=' + l : '';
			j.async = true;
			j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
			f.parentNode.insertBefore(j, f);
		})(window, document, 'script', 'dataLayer', 'GTM-TS48XJVF');
	</script>
	<!-- End Google Tag Manager -->

	<style>
		/* ------------- 保持其他样式不变 ------------- */
	
		body {
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
			text-align: center;
		}
	
		.container {
			text-align: center;
		}
	
		.title {
			color: red;
			padding: 10px;
			border-radius: 4px;
			font-size: 54px;
			margin-bottom: 5px;
			display: flex;
			align-items: center;
			justify-content: center;
		}
	
		.title img {
			margin-right: 10px;
			height: 24px;
			width: auto;
		}
	
		.gradient-box {
			background: linear-gradient(to right, #ff7e5f, #feb47b);
			height: 10px;
			margin-bottom: 10px;
		}
	
		/* 轮播图样式（PC 版） */
		.swiper-container {
			width: 800px;
			height: 400px;
			margin: 0 auto;
			position: relative;
		}
	
		.swiper-slide {
			text-align: center;
		}
	
		.swiper-slide img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}
	
		.swiper-button-prev,
		.swiper-button-next {
			color: #fff;
		}
	
		.swiper-pagination-bullet {
			background: rgba(0, 0, 0, 0.5);
		}
	
		.swiper-pagination-bullet-active {
			background: #fff;
		}
	
		.content-section {
			margin: 20px 0;
			text-align: left;
			padding: 0 15px;
		}
	
		.content-section h2 {
			color: #333;
		}
	
		.content-section p {
			color: #666;
			line-height: 1.5;
		}
	
		.header {
			margin: 20px 0;
		}
	
		.search-bar {
			display: flex;
			justify-content: center;
			align-items: center;
			margin-bottom: 20px;
		}
	
		/* 在.subtitle样式区块后添加 */
		.subtitle img {
			margin-right: 8px;
			height: 24px;
			width: auto;
			/* 新增限制 */
			max-width: 120px; /* 根据实际图片比例调整 */
			object-fit: contain;
		}

		.tab-select,
		.search-input {
			padding: 8px;
			cursor: pointer;
			border: 1px solid #ccc;
			margin: 0 5px;
			width: 100%;
			max-width: 180px;
			font-size: 16px;
			border-radius: 20px;
		}
	
		/* ▼▼▼ 需要新增/替换的代码 ▼▼▼ */
		.thumbnail-container {
		  display: grid;
		  grid-template-columns: repeat(2, 1fr);
		  gap: 15px;
		  padding: 10px;
		}

		.thumbnail {
			width: 100%;
			margin: 0;
			border: 1px solid #ddd;
			border-radius: 8px;
			overflow: hidden;
			display: flex;
			flex-direction: column;
			background: #fff;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
			transition: transform 0.2s;
		}

		/* 默认 PC 端样式保持不变 */
		.modal {
		  display: none;
		  position: fixed;
		  top: 0;
		  left: 0;
		  width: 100%;
		  height: 100%;
		  background: rgba(0,0,0,0.95);
		  z-index: 9999;
		  overflow-y: auto;
		}

		/* PC端默认弹窗内容，若需要可自行调整 */
		.modal-content {
		  position: absolute;
		  top: 50%;
		  left: 50%;
		  transform: translate(-50%, -50%);
		  width: 90vw;
		  max-width: 400px;
		  padding: 15px;
		  border-radius: 12px;
		  background: #fff;
		}

		/* 手机端样式：使用 flex 居中，弹窗内容占手机屏幕80% */
		@media (max-width: 600px) {
		  .modal {
			display: flex !important;
			justify-content: center;
			align-items: center;
			padding: 10px; /* 避免内容贴边 */
		  }
		  .modal-content {
			position: relative; /* 取消绝对定位 */
			width: 80vw;         /* 占屏幕80%宽度 */
			max-width: 80vw;
			max-height: 80vh;    /* 占屏幕80%高度 */
			padding: 0;          /* 如需要可增加内边距 */
			border-radius: 12px;
			background: #fff;
			overflow: hidden;    /* 防止视频溢出 */
		  }
		  /* 让视频在弹窗中自适应 */
		  #videoPlayer {
			width: 100%;
			height: 100%;
			object-fit: contain; /* 保持视频宽高比 */
		  }
		}

		/* 响应式调整（替换原有媒体查询） */
		@media (max-width: 600px) {
            /* 新增手机端图片调整 */
			.subtitle img {
				height: 20px;
				max-width: 100px;
			}
		}

		  .episode-info .preview-btn {
			padding: 10px 20px;
			font-size: 14px;
		  }

		@media (min-width: 601px) and (max-width: 1024px) {
		  .thumbnail-container {
			grid-template-columns: repeat(2, 1fr);
		  }
		}

		@media (min-width: 1025px) {
		  .thumbnail-container {
			grid-template-columns: repeat(3, 1fr);
		  }
		}

		.close {
			position: absolute;
			top: 10px;
			right: 20px;
			font-size: 24px;
			cursor: pointer;
		}
	
		.thumb-image {
			cursor: pointer;
			width: 100%;
			overflow: hidden;
		}
	
		.thumb-image img {
			width: 100%;
			height: auto;
			display: block;
		}
	
		.episode-info {
			padding: 10px;
			text-align: center;
			background: #f9f9f9;
		}
	
		.episode-info .episode-title {
			font-size: 16px;
			font-weight: bold;
			color: #333;
			cursor: pointer;
			display: block;
			margin-bottom: 8px;
		}
	
		.episode-info .preview-btn {
			padding: 8px 16px;
			font-size: 14px;
			border: none;
			background: #ff7e5f;
			color: #fff;
			border-radius: 4px;
			cursor: pointer;
			transition: background 0.3s ease;
		}
	
		.episode-info .preview-btn:hover {
			background: #feb47b;
		}
	
		/* ------------- 响应式调整 ------------- */
		@media (max-width: 600px) {
		  .thumbnail-container {
			grid-template-columns: repeat(2, 1fr); /* 强制双列 */
		  }
		  /* 如果有必要，也可以取消对 .thumbnail 的宽度控制，依靠 grid 自动控制宽度 */
		  .thumbnail {
			margin: 5px;
			/* 可选：移除固定宽度 */
			width: auto;
		  }

			/* 缩略图在手机端采用2列布局 */
	
			.episode-info .episode-title {
				font-size: 14px;
			}
	
			.episode-info .preview-btn {
				font-size: 12px;
				padding: 6px 12px;
			}
		}
	
		/*（可选）在平板设备上可适当调整宽度，如果需要可以添加另外的媒体查询 */
		@media (min-width: 601px) and (max-width: 1024px) {
			.thumbnail {
				width: calc(33.33% - 10px);
			}
		}
	</style>
	</head>
	
	<body>
		<!-- Google Tag Manager (noscript) -->
		<script>
			window.addEventListener('load', function () {
				var gtm = document.createElement('script');
				gtm.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-TS48XJVF';
				gtm.async = true;
				document.body.appendChild(gtm);
			});
		</script>
		<!-- End Google Tag Manager (noscript) -->
	
		<div class="container">
			<div class="title">
				<img alt="Icon" src="hot.webp" />
				Hot Drama
			</div>
			<div class="gradient-box"></div>
			<!-- 轮播图 -->
			<div class="swiper-container">
				<div class="swiper-wrapper">
					<div class="swiper-slide">
						<a href="https://short.kalostv.com/api/short/jump/675c53f73a3c9" target="_blank">
							<img alt="Image 1" src="ii1.webp" />
						</a>
					</div>
					<div class="swiper-slide">
						<a href="https://short.kalostv.com/api/short/jump/675c534ac599d" target="_blank">
							<img alt="Image 2" src="ii2.webp" />
						</a>
					</div>
					<div class="swiper-slide">
						<a href="https://short.kalostv.com/api/short/jump/675c531156f4f" target="_blank">
							<img alt="Image 3" src="ii3.webp" />
						</a>
					</div>
					<div class="swiper-slide">
						<a href="https://short.kalostv.com/api/short/jump/675c53f73a3c9" target="_blank">
							<img alt="Image 4" src="ii4.webp" />
						</a>
					</div>
					<div class="swiper-slide">
						<a href="https://short.kalostv.com/api/short/jump/675c8297121ed" target="_blank">
							<img alt="Image 5" src="ii5.webp" />
						</a>
					</div>
					<div class="swiper-slide">
						<a href="https://short.kalostv.com/api/short/jump/675c52b1b2dd8" target="_blank">
							<img alt="Image 6" src="ii6.webp" />
						</a>
					</div>
				</div>
				<!-- 左右导航按钮 -->
				<div class="swiper-button-prev"></div>
				<div class="swiper-button-next"></div>
				<!-- 分页器 -->
				<div class="swiper-pagination"></div>
			</div>
	
			<!-- 新内容区域 -->
			<div class="subtitle">
				<img alt="Icon" src="search.webp" />
				Search More Drama
			</div>
			<div class="gradient-box"></div>
			<div class="content-section">
				<div class="search-bar">
					<select class="tab-select" id="tabSelect" onchange="changeTab(this.value)">
						<option value="0">English</option>
						<option value="1">Indonesian</option>
						<option value="2">Spanish</option>
						<option value="3">French</option>
						<option value="4">Korean</option>
						<option value="5">Japanese</option>
						<option value="6">German</option>
						<option value="7">Thai</option>
						<option value="8">Traditional Chinese</option>
					</select>
					<input class="search-input" id="searchInput" onkeyup="filterThumbnails()" placeholder="Search Drama"
						type="text" />
				</div>
				<div class="thumbnail-container" id="thumbnailContainer">
				</div>
				<div style="text-align:center; margin: 20px;">
					<button id="loadMoreBtn">Load More</button>
				</div>
				<script>
					function changeTab(selectedValue) {
						currentTab = selectedValue;
						const container = document.getElementById("thumbnailContainer");
						container.innerHTML = "";
						loadedCounts[selectedValue] = 0;
						loadThumbnails(selectedValue);
					}
				</script>
			</div>
		</div>
	
		<!-- 视频弹窗 -->
		<!-- 替换原有视频弹窗 -->
		<div class="modal" id="videoModal">
			<div class="modal-content">
				<span class="close">&times;</span>
				<video controls id="videoPlayer" playsinline>
					<source id="videoSource" src="" type="video/mp4">
				</video>
			</div>
		</div>
	
		<!-- 引入剧集数据 -->
		<script src="thumbnailsData.js"></script>
	
		<!-- 全局变量定义 -->
		<script>
			// 全局变量定义
			let currentTab = "0";   // 默认英语类别（与下拉框第一个选项一致）
			const batchSize = 50;
			const loadedCounts = {};

			// 按批次加载函数（保持原有逻辑）
			function loadThumbnails(tab) {
				const container = document.getElementById("thumbnailContainer");
				if (!loadedCounts[tab]) {
					loadedCounts[tab] = 0;
				}
				const startIndex = loadedCounts[tab];
				const thumbnailsArray = thumbnailsData[tab] || [];
				const endIndex = Math.min(startIndex + batchSize, thumbnailsArray.length);
				for (let i = startIndex; i < endIndex; i++) {
					const tempDiv = document.createElement("div");
					tempDiv.innerHTML = thumbnailsArray[i];
					container.appendChild(tempDiv.firstElementChild);
				}
				loadedCounts[tab] = endIndex;
				const loadMoreBtn = document.getElementById("loadMoreBtn");
				loadMoreBtn.style.display = loadedCounts[tab] >= thumbnailsArray.length ? "none" : "block";
			}

			// 绑定点击事件，增加 event.isTrusted 检查，确保只响应用户操作
			document.getElementById("thumbnailContainer").addEventListener("click", function (event) {
				// 如果不是用户主动触发，则退出
				if (!event.isTrusted) return;

				// 如果点击的是“点击预览”按钮，则打开视频弹窗
				if (event.target.closest(".preview-btn")) {
					console.log("点击预览按钮", event.target);
					const thumbnailEl = event.target.closest(".thumbnail");
					const videoUrl = thumbnailEl.getAttribute("data-video");
					if (videoUrl) {
						openVideoModal(videoUrl);
					}
					event.stopPropagation();
					return;
				}

				// 如果点击的是缩略图区域或剧集标题，则跳转佣金链接
				if (event.target.closest(".thumb-image") || event.target.closest(".episode-title")) {
					const thumbnailEl = event.target.closest(".thumbnail");
					const commissionUrl = thumbnailEl.getAttribute("data-commission");
					if (commissionUrl) {
						window.open(commissionUrl, '_blank');
					}
					event.stopPropagation();
					return;
				}
			});

			// 打开视频弹窗的函数
			// 替换原有视频相关代码
				function openVideoModal(videoUrl) {
				  const videoPlayer = document.getElementById("videoPlayer");
				  const modal = document.getElementById("videoModal");

			      // 重置视频源
				  videoPlayer.pause();
				  videoPlayer.src = videoUrl;

				  // 直接显示弹窗，由 CSS 控制样式
				  modal.style.display = "block";
				}

			// 关闭弹窗（优化版）
			function closeVideoModal() {
				const videoPlayer = document.getElementById("videoPlayer");
				videoPlayer.pause();
				videoPlayer.removeAttribute('src');
				document.getElementById("videoModal").style.display = "none";
			}

			// 绑定事件
			document.querySelector('.close').addEventListener('click', closeVideoModal);
			document.getElementById("videoModal").addEventListener('click', function (e) {
				if (e.target === this) closeVideoModal();
			});

			// 窗口大小变化处理
			window.addEventListener('resize', function () {
				if (document.getElementById("videoModal").style.display === "block") {
					const videoPlayer = document.getElementById("videoPlayer");
					videoPlayer.style.maxHeight = window.innerHeight * 0.8 + 'px';
				}
			});

			// 点击弹窗背景关闭弹窗
			document.getElementById("videoModal").addEventListener("click", function (event) {
				if (event.target === this) {
					this.style.display = "none";
					document.getElementById("videoPlayer").pause();
					document.getElementById("videoSource").src = "";
				}
			});

			// 页面加载后延时加载剧集数据，确保页面渲染稳定
			document.addEventListener("DOMContentLoaded", function () {
				// 延时100毫秒加载数据，避免加载过程中产生意外的事件触发
				setTimeout(function () {
					loadThumbnails(currentTab);
				}, 100);
			});
		</script>
	
		<!-- 引入 Swiper 脚本 -->
		<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
		<script>
			var mySwiper = new Swiper('.swiper-container', {
				loop: true,
				autoplay: {
					delay: 1500,
					disableOnInteraction: true,
				},
				navigation: {
					nextEl: '.swiper-button-next',
					prevEl: '.swiper-button-prev',
				},
				pagination: {
					el: '.swiper-pagination',
					clickable: true,
				},
				speed: 1000,
			});
		</script>

	<!-- 引入 Swiper 脚本 -->
	<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
	<script>
		var mySwiper = new Swiper('.swiper-container', {
			loop: true,
			autoplay: {
				delay: 1500,
				disableOnInteraction: true,
			},
			navigation: {
				nextEl: '.swiper-button-next',
				prevEl: '.swiper-button-prev',
			},
			pagination: {
				el: '.swiper-pagination',
				clickable: true,
			},
			speed: 1000,
		});
	</script>
<script>
	function filterThumbnails() {
		// 1. 获取当前用户输入的搜索词，并转小写用于匹配
		const searchTerm = document.getElementById("searchInput").value.trim().toLowerCase();

		// 2. 获取当前选中的语言 tab（你在 changeTab 中使用了 currentTab 作标记）
		//    确保你的全局变量 `currentTab` 已声明并存储了当前选项卡值
		const tab = currentTab;

		// 3. 先清空容器
		const container = document.getElementById("thumbnailContainer");
		container.innerHTML = "";

		// 4. 如果当前 tab 无数据，或者 thumbnailsData[tab] 不存在，直接返回
		if (!thumbnailsData[tab]) {
			return;
		}

		// 5. 如果搜索词为空，则“恢复”原始全部结果
		if (searchTerm === "") {
			// 重置已加载计数
			loadedCounts[tab] = 0;
			// 重新调用原先的加载逻辑
			loadThumbnails(tab);
			// 显示“Load More”按钮
			document.getElementById("loadMoreBtn").style.display = "block";
			return;
		}

		// 6. 如果有搜索词，则在当前 tab 里做过滤
		//    这里简单处理：只要 HTML 片段中包含搜索词(不区分大小写)，就算匹配
		const allItems = thumbnailsData[tab];   // 所有HTML片段数组
		let filteredItems = allItems.filter(item => {
			// 转小写，与 searchTerm 作 includes 判断
			const lowerItem = item.toLowerCase();
			return lowerItem.includes(searchTerm);
		});

		// 7. 将搜索结果一次性加载到容器
		filteredItems.forEach(htmlSnippet => {
			let tempDiv = document.createElement("div");
			tempDiv.innerHTML = htmlSnippet;
			container.appendChild(tempDiv.firstElementChild);
		});

		// 8. 隐藏“Load More”按钮（因为此时是一次性显示所有匹配内容）
		document.getElementById("loadMoreBtn").style.display = "none";
	}
</script>
</body>

</html>